.now-playing-widget {
  --btn-color: rgba(0, 0, 0, 0);
  --btn-hover-color: rgba(255, 255, 255, 0.2);

  --cover-size: 32cqi;
  --image-border-radius: 12px;

  position: absolute;
  width: var(--cover-size);
  z-index: 4;

  display: flex;
  gap: max(12px, 1cqw);
  flex-direction: column;

  top: 50%;
  left: 0;

  transform: translate3d(0, -50%, 0);

  transition:
    left 0.5s ease,
    right 0.5s ease;

  &.hide {
    left: -100%;
  }

  .metadata-container {
    container-type: inline-size;
    width: 100%;

    .artists,
    .song-name {
      --max-width: 86cqw;
      --font-size: calc(clamp(0.5rem, 3cqw, 2.4rem) * 2);
      color: #fff;
      font-size: var(--font-size);
      font-family: var(--lucid-lyrics-font-family);
      font-weight: 600;
      line-height: 1.18;
      margin: 0 auto;
      opacity: 0.95;
      text-align: center;
      height: var(--font-size);
      max-width: var(--max-width);
    }

    .artists {
      --max-width: 68cqw;
      --font-size: calc(clamp(0.5rem, 3cqw, 2.4rem) * 1.5);
      font-weight: 500;
      opacity: 0.7;
      margin-top: 8px;
    }
  }

  .cover-art-container {
    position: relative;
    border-radius: var(--image-border-radius);
    overflow: hidden;

    .media-controls {
      display: flex;
      flex-direction: column;
      gap: 4px;
      height: 100%;
      width: 100%;
      background-color: rgba(0, 0, 0, 0.6);
      position: absolute;
      inset: 0;
      z-index: 2;
      opacity: 0;

      justify-content: center;

      container-type: size;
      transition: opacity 0.3s ease-in-out;

      &:hover {
        opacity: 1;
      }

      .lucid-lyrics-btn.show.icon svg {
        height: 100%;
        width: 100%;
      }

      .control-buttons,
      .playback-controls {
        --btn-icon-size: clamp(24px, 10cqh, 80px);
        display: flex;
        gap: 8px;
        height: fit-content;
        justify-content: center;
        align-items: center;
      }

      .control-buttons {
        --btn-color: rgba(0, 0, 0, 0.05);
        --btn-hover-color: rgba(var(--lucid-lyrics-text-rgb-color), 0.1);
        --border-color: rgba(var(--lucid-lyrics-text-rgb-color), 0.1);
        margin-top: min(16px, 4cqh);
        .lucid-lyrics-btn {
          padding: 12px;
        }
      }
      .play-pause-btn {
        --btn-icon-size: calc(clamp(24px, 10cqh, 80px) * 1.2);
      }

      &.has-custom-buttons {
        .heart-control {
          height: 50cqh;
          width: 50cqh;
        }
      }

      .heart-control {
        --btn-icon-size: 100%;
        aspect-ratio: 1 / 1;
        height: 68cqh;
        margin: auto;
        width: 68cqh;
        align-self: center;
        display: flex;
        justify-content: center;
        align-items: center;
      }

      .timeline-controls {
        padding: 0 16px;
        display: flex;
        align-items: center;
        gap: 4px;
        margin-bottom: min(24px, 6cqh);

        .time {
          font-size: 12px;
          line-height: 12px;
          color: #fff;
          font-family: var(--lucid-lyrics-font-family);
          font-weight: 600;
          width: 40px;
          text-align: center;
        }

        .timeline-controls .slider-bar {
          flex: 1;
        }
      }
    }
  }

  .cover-art-container,
  .cover-img {
    height: var(--cover-size);
    width: var(--cover-size);
  }

  .cover-img {
    background-size: cover;
    background-repeat: no-repeat;
    background-position: center center;
    position: relative;
  }
  .img-error-wrapper {
    position: absolute;
    z-index: 1;
    inset: 0;
    width: 100%;
    height: 100%;
    padding: 40cqi;

    .lucide {
      width: 100%;
      height: 100%;
    }
  }
  .cover-img-wrapper {
    &:before {
      content: "";
      width: 100%;
      height: 100%;
      -webkit-mask-position: left top;
      mask-position: left top;
      -webkit-mask-repeat: repeat-y;
      mask-repeat: repeat-y;
      -webkit-mask-size: contain;
      mask-size: contain;
      position: absolute;
      z-index: 99;

      background: linear-gradient(
        -45deg,
        rgb(238 238 238 / 25%) 40%,
        rgb(250 250 250 / 45%) 50%,
        rgb(238 238 238 / 25%) 60%
      );
      background-size: 500%;
      background-position-x: 100%;
      border-radius: 0.5cqw;
      visibility: visible;

      animation: BackgroundShimmer 1s infinite linear;
      animation-play-state: paused;
    }
    &.img-loading:before {
      animation-play-state: running;
    }

    &.img-loaded::before {
      visibility: hidden;
      animation-play-state: paused;
    }
  }
}

.marquee-container {
  overflow: hidden;
  white-space: nowrap;
  position: relative;
  mask-image: linear-gradient(90deg, transparent 0, #000 6px, #000 calc(100% - 6px), transparent);
  margin-inline-start: -8px;
}

.marquee-wrapper {
  display: inline-block;
  white-space: nowrap;
  animation: marquee var(--marquee-duration, 12s) linear infinite alternate;
  padding: 0 8px;
}

.marquee-container:hover .marquee-wrapper {
  animation-play-state: paused;
}

@keyframes marquee {
  0% {
    transform: translateX(calc(0px + min(-100% + var(--max-width, 85cqw), 0px) * 0));
  }
  10% {
    transform: translateX(calc(0px + min(-100% + var(--max-width, 85cqw), 0px) * 0));
  }
  90% {
    transform: translateX(calc(0px + min(-100% + var(--max-width, 85cqw), 0px) * 1));
  }
  100% {
    transform: translateX(calc(0px + min(-100% + var(--max-width, 85cqw), 0px) * 1));
  }
}
